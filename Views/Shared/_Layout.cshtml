@* <!DOCTYPE html> *@
@* <html lang="en"> *@
@* <head> *@
@*     <meta charset="utf-8" /> *@
@*     <meta name="viewport" content="width=device-width, initial-scale=1.0" /> *@
@*     <title>@ViewData["Title"] - Identity_JWT_Project</title> *@
@*     <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" /> *@
@*     <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" /> *@
@*     <link rel="stylesheet" href="~/Identity_JWT_Project.styles.css" asp-append-version="true" /> *@
@* </head> *@
@* <body> *@
@*     <header> *@
@*         <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3"> *@
@*             <div class="container-fluid"> *@
@*                 <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">Identity_JWT_Project</a> *@
@*                 <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent" *@
@*                         aria-expanded="false" aria-label="Toggle navigation"> *@
@*                     <span class="navbar-toggler-icon"></span> *@
@*                 </button> *@
@*                 <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between"> *@
@*                     <ul class="navbar-nav flex-grow-1"> *@
@*                             <li class="nav-item"> *@
@*                                 <a class="nav-link text-dark" asp-controller="Home" asp-action="Index">Home</a> *@
@*                             </li> *@

@*                             <li class="nav-item"> *@
@*                                 <a class="nav-link text-dark" asp-controller="Home" asp-action="Privacy">Privacy</a> *@
@*                             </li> *@

@*                             <!-- Roles menu --> *@
@*                             <li class="nav-item dropdown"> *@
@*                                 <a class="nav-link dropdown-toggle text-dark" href="#" id="rolesMenu" role="button" *@
@*                                    data-bs-toggle="dropdown" aria-expanded="false"> *@
@*                                     Roles *@
@*                                 </a> *@
@*                                 <ul class="dropdown-menu" aria-labelledby="rolesMenu"> *@
@*                                     <li> *@
@*                                         <a class="dropdown-item" asp-controller="Home" asp-action="Index">All Roles</a> *@
@*                                     </li> *@
@*                                     <li> *@
@*                                         <a class="dropdown-item" asp-controller="Home" asp-action="Create">Create Role</a> *@
@*                                     </li> *@
@*                                     <li><hr class="dropdown-divider" /></li> *@
@*                                     <li> *@
@*                                         <a class="dropdown-item" asp-controller="Home" asp-action="UsersWithRoles">Users & Roles</a> *@
@*                                     </li> *@
@*                                 </ul> *@
@*                             </li> *@

@*                             <!-- لو عندك Viewer في Home --> *@
@*                             <li class="nav-item"> *@
@*                                 <a class="nav-link text-dark" asp-controller="Home" asp-action="Viewer">Viewer</a> *@
@*                             </li> *@
@*                         </ul> *@


                    
@*                     <partial name="_LoginPartial" /> *@
@*                 </div> *@
@*             </div> *@
@*         </nav> *@
@*     </header> *@
@*     <div class="container"> *@
@*         <main role="main" class="pb-3"> *@
@*             @RenderBody() *@
@*         </main> *@
@*     </div> *@

@*     <footer class="border-top footer text-muted"> *@
@*         <div class="container"> *@
@*             &copy; 2025 - Identity_JWT_Project - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a> *@
@*         </div> *@
@*     </footer> *@
@*     <script src="~/lib/jquery/dist/jquery.min.js"></script> *@
@*     <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script> *@
@*     <script src="~/js/site.js" asp-append-version="true"></script> *@
@*     @await RenderSectionAsync("Scripts", required: false) *@
@* </body> *@
@* </html> *@


@using Microsoft.AspNetCore.Mvc.Controllers
@{
    string? currentController = (ViewContext.ActionDescriptor as ControllerActionDescriptor)?.ControllerName;
    string? currentAction = (ViewContext.ActionDescriptor as ControllerActionDescriptor)?.ActionName;
    Func<string, string, string> isActive = (c, a) =>
        (string.Equals(currentController, c, StringComparison.OrdinalIgnoreCase)
         && string.Equals(currentAction, a, StringComparison.OrdinalIgnoreCase))
        ? "active" : "";

    var appTitle = "Identity_JWT_Project";
}

<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - @appTitle</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <!-- Bootstrap Icons (for small, nice icons) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Identity_JWT_Project.styles.css" asp-append-version="true" />

    <style>
        /* App-wide polish */
        :root {
            --brand-start: #0d6efd;
            --brand-end: #6610f2;
        }

        header .navbar {
            background: linear-gradient(135deg, var(--brand-start), var(--brand-end));
        }

            header .navbar .navbar-brand,
            header .navbar .nav-link,
            header .navbar .dropdown-item {
                color: #fff;
            }

            header .navbar .dropdown-menu {
                background: rgba(0,0,0,.85);
            }

            header .navbar .dropdown-item:hover {
                background: rgba(255,255,255,.08);
            }

        .navbar .nav-link.active,
        .navbar .dropdown-toggle.show {
            text-decoration: underline;
            text-underline-offset: 4px;
        }
        /* Offcanvas width for comfy mobile nav */
        .offcanvas {
            width: 280px;
        }
        /* Main spacing */
        main {
            padding-block: 1.25rem 2.5rem;
        }

        /* Sticky footer */
        html, body {
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        main[role="main"] {
            flex: 1 0 auto;
        }

        footer {
            flex-shrink: 0;
        }

        /* Light/Dark toggle button */
        .theme-toggle {
            border: 1px solid rgba(255,255,255,.35);
            color: #fff;
        }

            .theme-toggle:hover {
                background: rgba(255,255,255,.1);
            }

        /* Make light/dark text adapt when theme is dark */
        [data-bs-theme="dark"] header .navbar .dropdown-menu {
            background: rgba(255,255,255,.08);
        }

        [data-bs-theme="dark"] header .navbar .dropdown-item {
            color: #eaeaea;
        }

        /* Optional: nicer focus state in nav */
        .navbar a:focus {
            outline: 2px dashed rgba(255,255,255,.7);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand fw-semibold d-flex align-items-center gap-2" asp-area="" asp-controller="Home" asp-action="Index">
                    <i class="bi bi-shield-lock-fill"></i> @appTitle
                </a>

                <!-- Theme toggle (visible on md+ inline; on mobile inside offcanvas too) -->
                <div class="d-none d-lg-flex align-items-center gap-2">
                    <button id="themeToggle" class="btn btn-sm theme-toggle" type="button" title="Toggle theme">
                        <i class="bi bi-moon-stars" id="themeIcon"></i>
                    </button>
                    <partial name="_LoginPartial" />
                </div>

                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#mainNav" aria-controls="mainNav" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Offcanvas for mobile nav -->
                <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="mainNav" aria-labelledby="mainNavLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="mainNavLabel"><i class="bi bi-menu-button-wide me-2"></i> Menu</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body d-flex flex-column gap-3">

                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link @isActive("Home", "Index")" asp-controller="Home" asp-action="Index">
                                    <i class="bi bi-house-door"></i> Home
                                </a>
                            </li>


                            <!-- Roles menu -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle @((currentController=="Home" && (currentAction=="Create" || currentAction=="UsersWithRoles")) ? "active" : "")"
                                   href="#" id="rolesMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-people-gear"></i> Roles
                                </a>
                                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="rolesMenu">
                                    <li>
                                        <a class="dropdown-item @isActive("Home","Index")" asp-controller="Home" asp-action="Index">
                                            <i class="bi bi-card-checklist me-2"></i> All Roles
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item @isActive("Home","Create")" asp-controller="Home" asp-action="Create">
                                            <i class="bi bi-plus-square me-2"></i> Create Role
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider" /></li>
                                    <li>
                                        <a class="dropdown-item @isActive("Home","UsersWithRoles")" asp-controller="Home" asp-action="UsersWithRoles">
                                            <i class="bi bi-people me-2"></i> Users & Roles
                                        </a>
                                    </li>
                                </ul>
                            </li>

                        </ul>

                        <!-- Theme + Auth (mobile) -->
                        <div class="d-lg-none mt-2">
                            <button id="themeToggleMobile" class="btn btn-outline-light w-100 mb-3" type="button" title="Toggle theme">
                                <i class="bi bi-moon-stars me-2" id="themeIconMobile"></i> Toggle Theme
                            </button>
                            <partial name="_LoginPartial" />
                        </div>

                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <main role="main">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top py-3 bg-body-tertiary">
        <div class="container d-flex justify-content-between align-items-center small">
            <span>&copy; @DateTime.UtcNow.Year - </span>
            <span>Develop By : <a href="https://github.com/MotayamTarada/MotayamTarada">Motayam Tarada</a></span>
            <a class="link-secondary" asp-area="" asp-controller="Home" asp-action="Privacy">
                <i class="bi bi-shield-lock me-1"></i> Privacy
            </a>
        </div>
    </footer>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
        // Theme persistence
        (function () {
            const root = document.documentElement;
            const stored = localStorage.getItem('theme');
            if (stored === 'dark' || stored === 'light') {
                root.setAttribute('data-bs-theme', stored);
            }

            const iconMap = {
                dark: 'bi-sun',
                light: 'bi-moon-stars'
            };

            function updateIcons(theme) {
                const desktopIcon = document.getElementById('themeIcon');
                const mobileIcon = document.getElementById('themeIconMobile');
                if (desktopIcon) {
                    desktopIcon.className = 'bi ' + (theme === 'dark' ? iconMap.dark : iconMap.light);
                }
                if (mobileIcon) {
                    mobileIcon.className = 'bi ' + (theme === 'dark' ? iconMap.dark : iconMap.light);
                }
            }

            updateIcons(root.getAttribute('data-bs-theme') || 'light');

            function toggleTheme() {
                const current = root.getAttribute('data-bs-theme') || 'light';
                const next = current === 'light' ? 'dark' : 'light';
                root.setAttribute('data-bs-theme', next);
                localStorage.setItem('theme', next);
                updateIcons(next);
            }

            const btnDesktop = document.getElementById('themeToggle');
            const btnMobile = document.getElementById('themeToggleMobile');
            btnDesktop && btnDesktop.addEventListener('click', toggleTheme);
            btnMobile && btnMobile.addEventListener('click', toggleTheme);
        })();
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>

